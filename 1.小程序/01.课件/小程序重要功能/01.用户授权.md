# 小程序用户授权

1. 截至21/12/22,小程序发展史上一共出现了3种获取用户个人信息方法
2. 首次登录授权:
   1. 早期
      1. API:**wx.getUserInfo(Object object)**
      2. 微信小程序早期时,许多开发者滥用该API(在onLoad直接调用wx.getUserInfo实现授权弹窗),导致用户体验极差,最终微信官方限制该功能
   2. 中期(使用时间最长的一个版本,于21年4月份正式失效)
      1. 组件:button
      2. 实现流程:
         1. **通过给button组件添加标签属性open-type="getUserInfo",可以实现用户点击button按钮弹出授权窗口功能**
         2. **给button组件绑定事件,事件名:getuserinfo**
         3. **在回调函数中,通过形参可以获取到用户的个人信息(event.detail.userInfo)**
         4. **将个人信息更新到data中**
         5. **在模版中使用插值语法进行动态展示**
   3. 最新
      1. API:**wx.getUserProfile(Object object)**
      2. 注意点:
         1. **配置对象中必传desc属性**
         2. **该API必须要在用户触发点击事件时,在事件回调函数中才能执行,否则无效**
         3. **该API每次调用都会弹出授权窗口,在该版本下,无法通过原先的方法实现二次登陆免授权,只能自己在首次授权之后,将用户信息存入本地存储Storage中**
            1. 该方案相比于中期版本的二次登陆免授权,数据时效较差,很可能出现数据不同步效果
3. 二次登录免授权(又称为**静默登录**)
   1. 需求:当用户进入小程序时,自动获取用户个人信息,并展示在页面上
   2. 拆解:
      1. 当用户进入小程序时
         1. 生命周期(就是最大的事件监听)
         2. 生命周期选择onLoad
      2. 自动获取用户个人信息
         1. 使用js获取用户个人信息
         2. **API:wx.getUserInfo(Object object)**
      3. 展示在页面上
         1. 通过将数据更新到data中,页面会自动渲染用户信息
   3. **注意:该API只能在用户经过首次登陆授权流程之后才能使用**
4. 奇特的组件
   1. 组件名:open-data
   2. 这个组件很鸡肋,能看不能用
   3. 该组件只能展示数据,对于用户来说有用,对于开发者来说没任何作用